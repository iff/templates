%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% Latex Style Definition and macros %%
%% Yves Ineichen                     %%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

%-----------
% packages 
%-----------

\usepackage[latin1]{inputenc}
\usepackage{url}
\usepackage{amsfonts}
\usepackage{graphicx}
\usepackage{cite}
%\usepackage{titleref}
\usepackage{amsmath}
%\usepackage{amsthm}
\usepackage{amssymb}
\usepackage{algorithm}
\usepackage{algorithmic}
\usepackage{placeins}
%\usepackage{picins}
\usepackage{listings}
\usepackage{theorem}
\usepackage{multirow}
\usepackage{fancyhdr}
\usepackage{xspace,varioref}
\usepackage{xcolor}
\usepackage{appendix}
\usepackage{multicol}
\usepackage{caption}
\usepackage{tikz}
\usetikzlibrary{shapes,arrows,snakes,backgrounds}
\usepackage{xspace}
\usepackage[colorlinks,linkcolor=blue,anchorcolor=blue,citecolor=green]{hyperref}
\usepackage{mparhack}
\usepackage{suffix}

%--------------
% page layout 
%--------------

%%\renewcommand\bibname{References}

%%\addtolength{\evensidemargin}{-0.0cm}
%%\addtolength{\oddsidemargin}{-0.0cm}
%%\addtolength{\textwidth}{0.0cm}
%%\addtolength{\topmargin}{-0.0cm}
%%\addtolength{\textheight}{0.0cm}

% text to footer dist
\addtolength{\skip\footins}{0mm}

%\renewcommand{\topfraction}{0.9} %max fraction of floats at top
%\renewcommand{\bottomfraction}{0.8} % max fraction of floats at bottom

%set max toc depth
\setcounter{tocdepth}{1}

%-----------------------------------------------------------------------
% Numbering 
% This section sets page and equation numbering to a appropriate format
%-----------------------------------------------------------------------

%figures section.num
\numberwithin{figure}{section}
%equations section.num
\numberwithin{equation}{section}

%---------
% THEOREM
%---------

\newtheorem{Thm}{Theorem}[section]
\theoremstyle{break}	\newtheorem{Cor}{Corollary}[section]
\theoremstyle{plain} 	\newtheorem{Lem}{Lemma}[section]

\theoremstyle{change}

{\theorembodyfont{\itshape} \newtheorem{Def}[Cor]{Definition}}
{\theorembodyfont{\itshape} \newtheorem{Obs}[Cor]{Observation}}

\theoremstyle{plain} \newtheorem{Exa}{Example}[section]
{\theorembodyfont{\upshape} \newtheorem{Rem}{Remark}[section]}

\theoremheaderfont{\scshape}

%----------
% Proofs
%----------

\def\proofname{Proof}
\def\sketchname{Proof sketch}
\def\qedsymbol{\RIfM@\bgroup\else$\bgroup\aftergroup$\fi
  \vcenter{\hrule\hbox{\vrule\@height.6em\kern.6em\vrule}\hrule}\egroup}
\def\qed{\RIfM@\else\unskip\fi\hskip 0pt plus 1fill\hbox{}\nobreak\hskip 1 em plus 1fill\nobreak
\qedsymbol}
\newenvironment{pf}[1][]{%
\par\topsep6\p@\@plus6\p@
\trivlist \itemindent 0pt
\ifthenelse{\equal{#1}{}}%
{\item[\hskip\labelsep\sl\proofname.]\ignorespaces}%
{\item[\hskip\labelsep\sl\proofname\ (#1).]\ignorespaces}}%
{\qed\endtrivlist}
\newenvironment{ps}[1][]{%
\par\topsep6\p@\@plus6\p@
\trivlist \itemindent 0pt
\ifthenelse{\equal{#1}{}}%
{\item[\hskip\labelsep\sl\sketchname.]\ignorespaces}%
{\item[\hskip\labelsep\sl\sketchname\ (#1).]\ignorespaces}}%
{\qed\endtrivlist}

%--------------
% Draft helpers
%--------------

% A simple colored box inlined with the text
%  #1: color to use
%  #2: text to put
\newcommand{\INLINEBOX}[2]{%
   \begin{center}%
    \fcolorbox{#1!60!black}{#1}{%
      \addtolength{\linewidth}{-0.6cm}%  fixed value, works for normal article text
      \begin{minipage}{\linewidth} #2 \end{minipage}%
    }%
   \end{center}\vspace{1pt}%
}

% A box at the margin containing the given text
\newcommand{\MARGINBOX}[1]{%
  \mbox{}%
  \marginpar%
   [\tiny\raggedleft\hspace{0pt}#1]%
   {\tiny\raggedright\hspace{0pt}#1}%
}

% mark specific elements: starred versions use inline boxes
\newcommand{\TODO}[2][]{\MARGINBOX{\textcolor{red!80!black}{\emph{ToDo (#1):}} #2}}
\WithSuffix\newcommand\TODO*[2][]{\INLINEBOX{red!20!white}{\emph{ToDo (#1):} #2}}

\newcommand{\FIXME}[2][]{\MARGINBOX{\textcolor{blue!80!black}{\emph{FixMe (#1):}} #2}}
\WithSuffix\newcommand\FIXME*[2][]{\INLINEBOX{blue!20!white}{\emph{FixMe (#1):} #2}}

\newcommand{\NOTE}[2][]{\MARGINBOX{\textcolor{green!80!black}{\emph{Note (#1):}} #2}}
\WithSuffix\newcommand\NOTE*[2][]{\INLINEBOX{green!20!white}{\emph{Note (#1):} #2}}

\newcommand{\DRAFT}[2][]{\MARGINBOX{\textcolor{blue!80!black}{\textsc{Draft (#1):}} #2}}
\WithSuffix\newcommand\DRAFT*[2][]{\INLINEBOX{blue!20!white}{\textsc{Draft (#1):} #2}}

%\newcommand{\FIXME}[1]{\mbox{}\marginpar[\small\raggedleft\hspace{0pt}%
%                                 \textcolor{blue}{\textit{FixMe:}}\\#1]%
%  {\small\raggedright\hspace{0pt}\textcolor{blue}{\textit{FixMe:}}\\#1}}
%\newcommand{\DRAFT}[1]{\mbox{}\marginpar[\small\raggedleft\hspace{0pt}%
%                                 \textcolor{blue!20!black}{\textsc{Draft:}}\\#1]%
%  {\small\raggedright\hspace{0pt}\textcolor{blue!20!black}{\textsc{Draft:}}\\#1}}
%\newcommand{\TODO}[1]{\mbox{}\marginpar[\small\raggedleft\hspace{0pt}%
%                                 \textcolor{red!20!black}{\textbf{ToDo:}}\\#1]%
%  {\small\raggedright\hspace{0pt}\textcolor{red!20!black}{\textbf{ToDo:}}\\#1}}
%\newcommand{\NOTE}[1]{\mbox{}\marginpar[\small\raggedleft\hspace{0pt}%
%                                 \textcolor{green}{\textit{Note:}}\\#1]%
%  {\small\raggedright\hspace{0pt}\textcolor{green}{\textit{Note:}}\\#1}}

%-------
% MISC 
%-------

% number down to subsubsections
\setcounter{secnumdepth}{3}

% own list symbol
\makeatletter
\renewcommand{\labelitemi}{$\cdot$}
\makeatother

%\bibliographystyle{alpha}%unsrt}
\bibliographystyle{unsrt}


%---------
% MACROS 
%---------

% standard "display math" macro, with optional number+label:
\def\dmath#1#2{
$$\lineskiplimit=1000pt \advance\lineskip by #1\jot 
\mathsurround=0pt \tabskip=0pt plus 1000pt
\everycr{\noalign{\penalty\interdisplaylinepenalty}}
\halign to \displaywidth{
\hfil$\displaystyle{##}$\tabskip=0pt&%
\hfil $\displaystyle{{}##{}}$\hfil &%
$\displaystyle{##}$\hfil \tabskip=0pt plus 1000pt minus 1000pt&%
\refstepcounter{equation}\label{##}\llap{(\theequation)}\tabskip=0pt\cr
\noalign{\ifdim \prevdepth>-1000pt \vskip -#1\jot\fi}
#2\crcr}$$}

%math bold font
\def\mbf#1{\mathbf{#1}}

% CR with double penalty:
\def\crd{\crcr\noalign{\unpenalty
\multiply\interdisplaylinepenalty by 2 \penalty \interdisplaylinepenalty}}

\def\eq{{}={}}
\arraycolsep 0pt

%-----------------------------------------------------------------------
% Stencil Macro
% This macro draws stencils C,E,W,N,S,F,B as arguements
%-----------------------------------------------------------------------

%TODO: positioning?
\newcommand{\istencil}[7]{
\begin{tikzpicture}[join=round, scale=0.5]
	\coordinate (C) at (0,0);
	\coordinate (E) at (2,0);
	\coordinate (W) at (-2,0);
	\coordinate (N) at (0,2);
	\coordinate (S) at (0,-2);
	\coordinate (F) at (-1,-1);
	\coordinate (B) at (1,1);

	\fill[black] (C) circle (2pt);
	\draw (C) node[above left] {#1};

	%\ifx0#2
	\if0#2
	\else
		\fill[black] (E) circle (2pt);
		\draw (C) -- (E) node[right] {#2};
	\fi

	\if0#3
	\else
		\fill[black] (W) circle (2pt);
		\draw (C) -- (W) node[left] {#3};
	\fi

	\if0#4
	\else
		\fill[black] (N) circle (2pt);
		\draw (C) -- (N) node[above] {#4};
	\fi

	\if0#5
	\else
		\fill[black] (S) circle (2pt);
		\draw (C) -- (S) node[below] {#5};
	\fi

	\ifx0#6
	\else
		\fill[black] (F) circle (2pt);
		\draw (C) -- (F) node[below left] {#6};
	\fi

	\ifx0#7
	\else
		\fill[black] (B) circle (2pt);
		\draw (C) -- (B) node[above right] {#7};
	\fi
\end{tikzpicture}
}

%% LISTING ENV
%TODO: label: label=#2 \thelstlisting
\lstnewenvironment{code}[2][] {\textsc{#1} \hspace{1cm} \hrulefill \lstset{language=C++, basicstyle=\ttfamily\scriptsize, numbers=left, tabsize=2, breaklines=true, label=#2}} {\hrule\smallskip}

%% OPAL STUFF
\newcommand{\opal}{\textsc{OPAL }}
\newcommand{\opalt}{\textsc{OPAL-t }}
\newcommand{\opalcycl}{\textsc{OPAL-cycl }}
\newcommand{\opalmap}{\textsc{OPAL-map }}
\newcommand{\opalenv}{\textsc{OPAL-envelop}}
\newcommand{\ippl}{\textsc{IPPL }}

\newcommand{\mad}{\textsc{mad }}
\newcommand{\madnine}{\textsc{mad9 }}
\newcommand{\madninep}{\textsc{mad9p }}
\newcommand{\madeight}{\textsc{mad8 }}

\newcommand{\classic}{\textsc{classic }}
\newcommand{\hfifepart}{\textsc{H5Part }}
\newcommand{\hfifefe}{\textsc{H5FED }}

\renewcommand{\epsilon}{\varepsilon} 
\renewcommand{\vec}[1]{{\bf #1}} 
\newcommand{\dt}[1]{\frac{\partial #1}{\partial t}}
\newcommand{\dtt}[1]{\frac{\partial^2 #1}{\partial t^2}}
\newcommand{\dtvec}[1]{\frac{\partial {\mathbf #1}}{\partial t}}
\newcommand{\dttvec}[1]{\frac{\partial^2 {\mathbf #1}}{\partial t^2}}
\newcommand{\rot}{\vec{\nabla} \wedge }
\renewcommand{\div}{\vec{\nabla} \cdot }

\def\vec#1{\mathbf{#1}}
\def\vecg#1{\boldsymbol{#1}}
\def\norm#1{\| #1 \|} 
\def\tr{^{\!\top}}

\def\curl{{\bf curl}\,}
\def\curlp{{\rm curl}_p\,}
\def\div{{\rm div}\,}
\def\grad{\nabla}
\def\gradp{\nabla_p}
\def\dotp#1#2{\langle#1,#2\rangle}
\def\eps{\varepsilon}

\newcommand{\mat}[1]{\ensuremath{\boldsymbol{#1}}}
\newcommand{\vect}[1]{\ensuremath{\mathbf{#1}}}
\newcommand{\iprod}[2]{\ensuremath{\langle#1,#2\rangle}}
\newcommand{\abs}[1]{\ensuremath{|#1|}}

\newcommand{\Nedelec}{N\'{e}d\'{e}lec}

\newcommand{\id}[1]{\structure{#1}}

\newcommand {\Co}{{\mathbb{C}}}
\newcommand {\Int}{{\mathbb{Z}}}
\newcommand {\Nat}{{\mathbb{N}}}
%
%
\newcommand {\Hcurl}{{H(\mathbf{curl};\Omega)}}
\newcommand {\Hocurl}{{H_0(\mathbf{curl};\Omega)}}
\newcommand {\Hdiv}{{H(\mathrm{div};\Omega)}}
\newcommand {\Hodiv}{{H_0(\mathbf{div};\Omega)}}
%
\renewcommand {\Re}{{\rm I \kern-2pt R}}
\newcommand{\vc}[1]{\mbox{\boldmath $#1$}}

